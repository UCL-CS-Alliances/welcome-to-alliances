<nav class="nav-bar" aria-label="Primary">
  <ul class="nav-root">
    {% for item in site.data.navigation.root %}
      {% if item.type == "link" %}
        <li class="nav-col nav-item">
          <a class="nav-link" href="{{ item.url | relative_url }}">{{ item.label }}</a>
        </li>

      {% elsif item.type == "dropdown" and item.audience %}
        <!-- Audience-driven dropdown -->
        <li class="nav-col">
          <details class="menu">
            <summary>{{ item.label }}</summary>
            <ul class="menu-list" role="menu">
              {% assign svc = site.services | where_exp: "s","s.show_in_nav != false" %}
              {% for s in svc %}
                {% assign audiences = s.audience %}
                {% assign aud_ok = false %}
                {% if audiences %}
                  {% if audiences contains item.audience or audiences == item.audience %}
                    {% assign aud_ok = true %}
                  {% endif %}
                {% endif %}
                {% if aud_ok %}
                  <li role="none">
                    {% if s.nav_active == false %}
                      <span role="menuitem" class="nav-link disabled" aria-disabled="true" tabindex="-1">{{ s.title }}</span>
                    {% else %}
                      <a role="menuitem" class="nav-link" href="{{ s.url | relative_url }}">{{ s.title }}</a>
                    {% endif %}
                  </li>
                {% endif %}
              {% endfor %}
            </ul>
          </details>
        </li>

      {% elsif item.type == "dropdown" and item.items %}
        <!-- Static dropdown (Account) -->
        <li class="nav-col">
          <details class="menu">
            <summary>{{ item.label }}</summary>
            <ul class="menu-list" role="menu">
              {% for link in item.items %}
                <li role="none">
                  {% if link.active %}
                    <a role="menuitem" class="nav-link" href="{{ link.url | relative_url }}">{{ link.label }}</a>
                  {% else %}
                    <span role="menuitem" class="nav-link disabled" aria-disabled="true" tabindex="-1">{{ link.label }}</span>
                  {% endif %}
                </li>
              {% endfor %}
            </ul>
          </details>
        </li>
      {% endif %}
    {% endfor %}
  </ul>
</nav>
